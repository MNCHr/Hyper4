CLEAN SLATE DESIGN

Objective: determine all steps necessary to generate tset_control table entries

action set_next_action(next_action, state) {
  modify_field(parse_ctrl.next_action, next_action);
  modify_field(parse_ctrl.state, state);
}

action extract_more(numbytes) {
  modify_field(parse_ctrl.numbytes, numbytes);
  modify_field(parse_ctrl.next_action, EXTRACT_MORE);
  resubmit(fl_extract_more);
}

table tset_control {
  reads {
    meta_ctrl.program : exact;
    parse_ctrl.numbytes : exact;
    parse_ctrl.state : exact;
  }
  actions {
    set_next_action;
    set_next_action_chg_program;
    extract_more;
    extract_more_chg_program;
  }
}

Ignore set_next_action_chg_program and extract_more_chg_program for now.

parse_ctrl.state: an integer corresponding to a (current, list of preceding states) tuple.  It identifies a unique path through the parse tree from the start parse_state to the current parse_state.

parseControlStateUIDs (dictionary):
- key:   tuple   - (parse_state, list of preceding states)
- value: integer - parse_ctrl.state

bits_needed_total (dictionary):
- key: (parse_state, list of preceding states)
- value: numbits

1. set_next_action | extract_more ...

HP4 does a resubmit for every parse_state that requires more bytes than what have previously been extracted.

For parse_ctrl.state == 0 ('start'), the question is whether the combined usage of 'current' and 'select' statements (bits_needed_total) require more than the SEB number of bytes.

For all other parse_ctrl.states, we should assume the required number of bytes have already been extracted.  An extract_more comes from a tset_inspect_XX_YY result that identifies the next parse_ctrl.state to transition to.  But once we have extracted more, should we not be in a new parse_ctrl.state?  We should - this implies we need to change setup.p4t's extract_more definition to include the new pc.state as a parameter.

What happens next depends on the return statement.
- select:
    apply tset_inspect_XX_YY
      set_next_action 
- unconditional return to another parse_state:
- unconditional return to ingress
